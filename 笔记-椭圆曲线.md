## 学习 An introduction to mathmetical cryptography 椭圆曲线

椭圆曲线是是一系列下列等式解的集合：

> Y^2=X^3+AX+B

我们可以定义椭圆曲线上的“加法”，首先确定椭圆曲线上的两个点P、Q，过两点划一条直线，直线与椭圆曲线交于第三点R，将第三点R关于x轴对称得到R'，定义P "+" Q = R'。
这个加法有一些地方需要商讨。
1. P"+"P的情况下，过两点所作的就是椭圆曲线在这一点的切线
2. 若选择的两点关于x周对称，则过两点产生的直线只与椭圆曲线交于两点。这时我们约定加法结果点在无穷远处
3. 无穷远处点与椭圆曲线上一点加法结果就是椭圆曲线上这一点自己。

此外，仅当4A^3+27B^2!=0时，椭圆曲线与x轴交于不同三点，不存在奇异点。

总结上述讨论的椭圆曲线加法：

> 1. P+O=O+P=P
> 2. P+(-P)=O
> 3. (P+Q)+R=P+(Q+R)
> 4. P+Q=Q+P

附加上上述的加法规则后，椭圆曲线成为阿贝尔群。

接下来需要寻找显式的公式以便方便地进行椭圆曲线上的加法。

椭圆曲线的加法算法：
> E:Y^2=X^3+AX+B
> P1,P2是E上的点
> 1. 若P1=O,则P1+P2=P2
> 2. 否则P1=(x1,y1),P2=(x2,y2)
> 3. if x1=x2 and y1=-y2，P1+P2=O
> 4. 若P1=P2,则λ=(3x1^2 + A)/(2y1).
> 5. 若P1！=P2，则λ=（y2-y1）/(x2-x1)
> 6. x3=λ^2-x1-x2
> 7. y3=λ(x1-x3)-y1
> 8. P1+P2=(x3,y3)


### 有限域上的椭圆曲线

此时，椭圆曲线上的所有点坐标都属于有限域F(p)。

比如对于有限域F(13)上的椭圆曲线E,我们先把x取遍0-12，计算y^2=x^3+Ax+B,看计算结果模13后是否是这个有限域上的数的平方。

通过逐个检验我们可以得到有限域上椭圆曲线上的所有点。随后我们按照上面的椭圆曲线上两点之间的加法规则计算两点的加法结果，只是所有的运算都在有限域上进行。这样我们最终得到的点(x3,y3)也是有限域上的点，且一点在有限域的椭圆曲线上。

根据以上的结论，有限域上椭圆曲线的加法规律使得有限域上的椭圆曲线成为一个有限群。

> (Hasse)E是有限域F(p)上的椭圆曲线，则E上的点有p+1-tp个，tp<=2√p

但是我们并不能直接推算出某个有限域上椭圆曲线有多少点，我们只能逐个检查，这花费线性搜索时间。

### 椭圆曲线离散对数问题（ECDLP）

先考虑一般意义上的离散对数问题。
考虑有限域F(p)，存在一个生成元g，使得这个有限域里所有的非0元都是g的某个次方。特别地，g^(p-1)=1.
1，g^1,g^2,...g^(p-2)就是有限域上的所有元素的集合。

DLP问题：h是有限域F(p)上的非零元素，求x，x使得g^x=h (mod p)

再考虑椭圆曲线有限域下的。选择有限域F(p)上的椭圆曲线E，已知有限域椭圆曲线上两点P，Q，求P连加多少次等于Q。
ps.在实际的加密情况下，一方通过对P连加得到Q，随后公布P，Q，因此Q一定是P的某些次连加的产物。
第二，如果存在一个数n，使得Q=nP，则除了n一定还存在其他数x满足Q=xP。（因为P,2P,3P,...中一定有两个值相同的，假设为kP,jP,取s=j-k，则sP=O，找一个最小的这样的s，把他称为P的order，则Q=(n+is)P,i是整数）

再先考虑已知n（Z中），P（有限域的椭圆曲线上点），怎样有效计算nP。
> 先把n转换为二进制表示。
> 随后计算Q0=P,Q1=2Q0,Q2=2Q1,...Qr=2Q(r-1)
> 得到一系列Q，Qi=(2^i)P
> 最后计算nP=n0Q0+n1Q1+...+nrQr

### 椭圆曲线加密

1. elliptic Diffie-Hellman key exchange
> Alice和Bob约定了特定的椭圆曲线E和上面一点P。Alice选择一个保密的数据n(A)，Bob选择n(B),Alice计算Q(A)=n(A)P,Bob计算Q(B)=n(B)P。他们相互交换计算所得的Q值。Alice随后计算n(A)Q(B),Bob计算n(B)Q(A).从而他们现在拥有共享的秘密（n(A)n(B)）P,他们可以把它当成私人密钥进行对称加密通信。

2. Elliptic ElGamal public key cryptosystem

> Alice和Bob商定一个共用的质数p，一个有限域上的椭圆曲线，以及曲线上的一个点P. Alice选择一个秘密n(A)，公开Q(A)=n(A)P作为自己的公钥。Bob的明文消息是曲线上一点M，他选择一个整数k作为临时密钥并计算C1=kP和C2=M+kQ(A).他发送这两个点C1,C2给Alice，Alice通过计算C2-n(A)C1=M就可以得到明文信息

> 这个方案存在的问题：1. 明文怎样才能转换为有限域椭圆曲线上的点？毕竟曲线上至多也就只有p个点，而明文可以有无穷多。


### 椭圆曲线上的有限阶点
> m>=1.若有限域椭圆曲线上的点P满足mP=O，则P就是有限域椭圆曲线E上阶为m的点。我们把所有阶为m的这样点的集合记为E[m]。
> 显然若P，Q都在E[m]中，则P+Q,-P都在E[m]中。这样一来E[m]就成为了E的子群。

**想看明白weil pairing只能回头看明白这一段**
### 环
环R上有两个操作，“+”和“*”，+满足以下规则：
1. 有零元
2. 加法有逆元
3. 加法可交换
4. 加法满足结合律
（事实上，如果R只满足以上规律且包含操作符+，就是一个交换群）
*满足以下规则：
1. 有1元
2. 乘法满足集合率
3. 乘法可交换
+，*满足：
1. 分配律

一个环若是每个其中的元素对于乘法都有逆元，则R就是一个域。

定义：R为环，令m∈R且m!=0,则将关于a模m同余的所有元素记为a的同余类。记R/(m)或R/mR为所有这样的同余类（模m同余）的集合的集合。把他们称为环R关于m的商环。

### 多项式环和欧几里得算法
若R是环，则所有的系数属于R的多项式构成R的多项式环，记为R[x].
deg(f)=n若多项式f(x)的最高次项为n。

### 多项式商环和质数幂次有限域

m∈F[x],m是非零多项式，则从F[x]/(m)中任取一个集合(代表元为a(x))，集合中的任意一个多项式r(x)总是满足:
deg r< deg m and a(x)与r(x)同余（因为有a = m*k+r）

F(p)为有限域，m∈F(p)[x],m非零且非常数多项式，次数为d，则多项式商环F(p)[x]/(m)恰好包含p^d个元素。

中间省略了多项式商环推导的部分

定义：我们记一个恰好含有p^d个元素的域为F(p^d)，由之前的推导可知，这样的域总是存在，而且任何两个具有p^d个元素的域本质上是相同的。

